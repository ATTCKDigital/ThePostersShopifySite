{% capture collection_handle %}
  {{ product-loop | handleize }}
{% endcapture %}
{% capture url %}
  {% if collection_handle != "" %}
    /collections/{{ product-loop }}{{ product.url }}
  {% else %}
    {{ product.url }}
  {% endif %}
{% endcapture %}

<div class="product">  
  <div class="image">
    <a href="{{ url }}">
      <img src="{{ product.featured_image | product_img_url: 'large' }}" alt="{{ product.title | escape  }}" />
    </a>
  </div>
  <div class="details">
    <a href="{{ url }}">{{ product.title }}</a>
  </div>
</div>